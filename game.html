<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>Duck hunt</title>
<script src="lib/easeljs-0.7.0.min.js"></script>
<script>
var canvas;
var stage;
var img;
var bg;
var score;
var bmpList;
var bitmap;
var txt;
var shotsTxt;

var gameTxt;
var mouseTarget;
var clicked;
var theSprite = new Image();
var instance;
var shots;

function init(){
	canvas = document.getElementById("canvas");
	stage = new createjs.Stage(canvas);
	score = 0;
	shots =3;
	
	stage.addEventListener("click", shotFiredEvent);
	
	img = new Image();
	img.src = "img/background.png";
	img.onload = setBG;
	
	var duck = new Image();
	duck.src = "img/duck.png";
	duck.onload = createDucks;
	
	theSprite.onload = handleImageLoad;
	theSprite.src="img/theDuck.png";
	

	
}

function handleImageLoad(e){
	var data = {
		images: ["img/theDuck.png"],
		frames: {width: 75, height: 75},
		animations: {fly:[0,11], shot:[12], die:[15,17]}
	};
	
	var spriteSheet = new createjs.SpriteSheet(data);
	instance = new createjs.Sprite(spriteSheet, "fly");


	stage.addChild(instance);
}

function createDucks(event){
	var image = event.target;
	var container = new createjs.Container();
	stage.addChild(container);
	var l = 5;
	bmpList = [];
	for(var i=0; i<l; i++){
		bitmap = new createjs.Bitmap(image);
		container.addChild(bitmap);
		bitmap.name="duck" + i;
		resetDuck(bitmap);
		bitmap.regX = bitmap.image.width /2|0;
		bitmap.regY = bitmap.image.height/2|0;
		bitmap.mouseEnabled = true;
		bitmap.addEventListener("click", handleMouseEvent); 
		bmpList.push(bitmap);
	}
	txt = new createjs.Text("Score 0", "24px Arial", "#666");
	txt.textBaseLine = "top";
	txt.x = 800;
	txt.y = 20;
	stage.addChild(txt);
	
	shotsTxt = new createjs.Text("Shots 3", "24px Arial", "#666");
	shotsTxt.textBaseLine = "top";
	shotsTxt.x = 0;
	shotsTxt.y = 20;
	stage.addChild(shotsTxt);
	
	play = true;
	createjs.Ticker.addEventListener("tick", handleTick);
}

function resetDuck(duck){
	duck.x = canvas.width + Math.random() * 500;
	duck.y = canvas.height * Math.random()|0;
	duck.speed = (Math.random() * 5) + 2;
}

function setBG(event){
	bg = new createjs.Bitmap(img);
	stage.addChild(bg);
	stage.addChild(text);
	stage.update();
	//createjs.Ticker.addEventListener("tick", handleTick);
}

function handleMouseEvent(evt) {
	//alert(evt.target.name);
	resetDuck(evt.target);
	score +=50;
	clicked = false;
	stage.update();
}

function shotFiredEvent(evt)
{
	shots-=1;	
}

function handleTick(){
	if(play == true){
		var l = bmpList.length;
		for(var i=0; i<l; i++){
			var bmp = bmpList[i];
			if(bmp.x > -200){
				bmp.x -= bmp.speed;
			}
		}
		if(shots==0)
		{
			gameOver();	
		}
	}
	txt.text = "Score: " + score;
	shotsTxt.text = "Shots: " + shots;
	stage.update();
}

function gameOver(){
	gameTxt = new createjs.Text("Game Over\n\n", "36px Arial", "#666");
	gameTxt.text += "Click to play again";
	gameTxt.textAlign = "center";
	gameTxt.x = canvas.width / 2;
	gameTxt.y = canvas.height / 3;
	stage.addChild(gameTxt);
	play = false;
	var l = bmpList.length;
	for(var i=0; i<l; i++){
		var bmp = bmpList[i];
		resetDuck(bmp);
	}
	stage.update();
	canvas.onclick = handleClick;
}

function handleClick(){
	canvas.onclick = null;
	stage.removeChild(gameTxt);
	score = 0;	
	shots = 3;
	play = true;
}
</script>
</head>

<body onLoad="init();">
<canvas id="canvas" width="960" height="580"></canvas>

</body>
</html>