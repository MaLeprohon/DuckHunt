<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>Duck hunt</title>
<script src="lib/easeljs-0.7.0.min.js"></script>
<script>
var canvas;
var stage;
var img;
var bg;

var score;
var bmpList;
var bitmap;
var scoreTxt;
var shotsTxt;

var gameTxt;
var mouseTarget;
var clicked;
var spriteSource = new Image();

var theDuck;
var shots;

var speedX;
var speedX2;
var speedY;
var speedY2;

function init(){
	canvas = document.getElementById("canvas");
	stage = new createjs.Stage(canvas);
	score = 0;
	shots =3;
	speedX=5;
	speedY=-5;
	speedX2=8;
	speedY2=-4;
	
	
	canvas.addEventListener("click", shotFiredEvent);
	
	img = new Image();
	img.src = "images/back2.png";
	img.onload = setBG;
	
	var duck = new Image();
	duck.src = "img/theDuck.png";
	duck.onload = createDucks;

	var test = new Image();
	test.src = "images/largeTree.png";
	test.onload = addTreeAndText;
	
	
	
	
}

function addTreeAndText(event)
{
	var image = event.target;
	var bitmap;
	var container = new createjs.Container();
	stage.addChild(container);

	bitmap = new createjs.Bitmap(image);
	container.addChild(bitmap);
	bitmap.x = 340;
	bitmap.y = 415;
	bitmap.regX = bitmap.image.width;
	bitmap.regY = bitmap.image.height;
	
	scoreTxt = new createjs.Text("Score 0", "24px Arial", "#FFF");
	scoreTxt.textBaseLine = "top";
	scoreTxt.x = 755;
	scoreTxt.y = 460;
	container.addChild(scoreTxt);
	
	shotsTxt = new createjs.Text("Shots 3", "24px Arial", "#FFF");
	shotsTxt.textBaseLine = "top";
	shotsTxt.x = 120;
	shotsTxt.y = 460;
	container.addChild(shotsTxt);
}

function createDucks(event){
	var container = new createjs.Container();
	stage.addChild(container);
	
	var data = {
		images: [event.target],
		frames: {width: 75, height: 75},
		animations: {"flyingTopLeft":[0,2, "flyingTopLeft", 0.5],
					 "flyingLeft":[9,10, "flyingLeft", 0.5],
					 "flyingTopRight":[3,5, "flyingTopRight", 0.5],
					 "flyingRight":[6,8, "flyingRight", 0.5],
					  "shot":[12],
					  "die":[15,17]}
	};
	var spriteSheet = new createjs.SpriteSheet(data);
	
	var l = 5;
	bmpList = [];
	for(var i=0; i<l; i++){
		theDuck = new createjs.Sprite(spriteSheet, "flyingTopRight");
		//theDuck.setTransform(170, 330, 1, 1);
		theDuck.setTransform(170, 330, 1, 1);
		theDuck.framerate = 30;
		container.addChild(theDuck);
		
		theDuck.mouseEnabled = true;
		theDuck.addEventListener("click", duckShotEvent); 
		bmpList.push(theDuck);
	}
	
	play = true;
	createjs.Ticker.addEventListener("tick", handleTick);
}


function resetDuck(duck){
	duck.x = canvas.width + Math.random() * 500;
	duck.y = canvas.height * Math.random() | 0;
	duck.speed = (Math.random() * 5) + 2;
}

function setBG(event){
	bg = new createjs.Bitmap(img);
	stage.addChild(bg);
	stage.addChild(text);
	stage.update();
}

function duckShotEvent(evt) {
	//alert(evt.target.name);
//	resetDuck(evt.target);
	evt.target.gotoAndPlay("shot");
	score +=50;
	clicked = false;
	stage.update();
}

function shotFiredEvent(evt)
{
	shots-=1;	
}

function handleTick(event){
	if(play == true){
		/*
		var l = bmpList.length;
		for(var i=0; i<l; i++){
			var bmp = bmpList[i];
			bmp.x +=speedX+i;
			bmp.y +=speedY-2*i;
		/*	if(bmp.x > -100){
				bmp.x -= speedX;
				bmp.y +=speedY;
			}
			else{
				resetDuck(bmp);	
			}
		}
		*/
		bmpList[0].x +=speedX;
		bmpList[0].y +=speedY;
		bmpList[1].x +=speedX2;
		bmpList[1].y +=speedY2;
		
		var l = bmpList.length;
		for(var i=0; i<l; i++){
			var bmp = bmpList[i];
			if(bmp.x > canvas.width-40)
			{
				bmp.x = !bmp.x;
			}
			if(bmp.y <0 || bmp.y > canvas.height)
			{
				speedY *=-1;
			}
		}
		
		if(shots==0)
		{
			gameOver();	
		}
	}
	scoreTxt.text =  score;
	shotsTxt.text =  shots;
	stage.update(event);
}


function gameOver(){
	gameTxt = new createjs.Text("Game Over\n\n", "36px Arial", "#666");
	gameTxt.text += "Click to play again";
	gameTxt.textAlign = "center";
	gameTxt.x = canvas.width / 2;
	gameTxt.y = canvas.height / 3;
	stage.addChild(gameTxt);
	play = false;
	var l = bmpList.length;
	for(var i=0; i<l; i++){
		var bmp = bmpList[i];
		resetDuck(bmp);
	}
	stage.update();
	canvas.onclick = handleClick;
}

function handleClick(){
	canvas.onclick = null;
	stage.removeChild(gameTxt);
	score = 0;	
	shots = 3;
	play = true;
}
</script>
</head>

<body onLoad="init();">
<canvas style="border:2px solid; background:#62c0d3" id="canvas" width="900" height="542"></canvas>

</body>
</html>